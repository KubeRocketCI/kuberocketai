# Story 01.06: Basic CLI + Homebrew Publication

## Status

| Field                  | Value                          |
|------------------------|--------------------------------|
| Status                 | Completed                      |
| Epic                   | Epic 1 - KubeRocketAI Baseline |
| Priority               | High                           |
| Estimated Story Points | 5                              |
| Jira                   | [EPMDEDP-15502]                |

## Dependencies

- **None**: This story is self-contained and does not depend on other stories.

## Story

**As a** Framework User,
**I want** a basic `krci-ai` CLI tool with core commands published via Homebrew that includes embedded asset management,
**so that** I can easily install and use the KubeRocketAI framework with standard CLI commands while the full feature set is being developed.

## Acceptance Criteria

1. `krci-ai --help` and `krci-ai --version` commands work correctly
2. `brew install kuberocketai/tap/krci-ai` works on macOS
3. Basic command structure includes `install` command
4. Cross-platform builds are generated for macOS, Linux, and Windows
5. Homebrew tap repository is created and published
6. CLI tool integrates seamlessly with manual agent creation from Stories 1.1-1.5
7. CI/CD pipeline produces automated releases
8. Cross-platform installation testing validates CLI functionality on macOS, Linux, and Windows
9. Assets are properly embedded in the CLI binary using Go embed directives

## Description

This story establishes the basic CLI infrastructure for the KubeRocketAI framework, providing users with a standardized command-line interface for framework installation and management. Unlike the previous agent definition stories, this story focuses on distribution and installation infrastructure, creating the foundation for users to easily access and deploy the framework assets created in Stories 01.01-01.05. The CLI tool bridges the gap between manual framework usage and automated deployment, enabling cross-platform distribution via Homebrew while maintaining compatibility with the existing agent ecosystem.

## Tasks/Subtasks

- [x] Task 1: Initialize Go CLI Framework (AC: 1, 3)
  - [x] Create Go module with Cobra CLI framework
  - [x] Implement basic command structure (install command)
  - [x] Add version and help command functionality
  - [x] Create CLI configuration and argument parsing
  - [x] Add colorized output for better user experience
- [x] Task 2: Implement Core Command Structure (AC: 1, 3, 6)
  - [x] Create `krci-ai install` command skeleton
  - [x] Add command help text and usage examples
  - [x] Implement basic error handling and user feedback
- [x] Task 3: Set Up Cross-Platform Build System (AC: 4, 7)
  - [x] Configure GoReleaser for automated builds
  - [x] Set up GitHub Actions for CI/CD pipeline
  - [x] Create build configurations for macOS, Linux, Windows
  - [x] Add ARM64 support for Apple Silicon
  - [x] Test cross-platform binary generation
- [x] Task 4: Create Homebrew Distribution (AC: 2, 5)
  - [x] Create Homebrew tap repository
  - [x] Configure tap with krci-ai formula
  - [x] Set up automated tap updates from releases
  - [x] Test Homebrew installation process
  - [x] Document Homebrew installation instructions
- [x] Task 5: Implement Agent Integration (AC: 6)
  - [x] Implement `krci-ai install` command to create target repository structure
    - Create `./krci-ai/` directory structure in current working directory
    - Copy embedded `assets/framework/core/agents/*.yaml` to `./krci-ai/agents/`
    - Copy embedded `assets/framework/core/tasks/*.md` to `./krci-ai/tasks/`
    - Copy embedded `assets/framework/core/templates/*.md` to `./krci-ai/templates/`
    - Copy embedded `assets/framework/core/data/*.md` to `./krci-ai/data/`
    - Preserve file structure and maintain asset integrity during copy
  - [x] Create basic agent discovery for installed `./krci-ai/` directory structure
    - Scan `./krci-ai/agents/` directory for agent files after installation
    - Read agent metadata from YAML files in target repository
    - Handle cases where `./krci-ai/` directory doesn't exist (not installed)
  - [x] Implement simple agent file listing functionality
    - Basic `krci-ai list agents` command that scans `./krci-ai/agents/` directory
    - Show agent name, role, and description from installed agent files
    - Display message if framework not installed in current directory
  - [x] Add basic validation that framework is properly installed
    - Check if `./krci-ai/` directory structure is present
    - Verify all required subdirectories exist (agents, tasks, templates, data, config)
    - Confirm agent files are properly copied from embedded assets
- [x] Task 6: Create Release Automation (AC: 7)
  - [x] Configure GitHub Actions for automated releases
  - [x] Set up release versioning strategy
  - [x] Create release notes automation
  - [x] Test full release pipeline
  - [x] Document release management process
- [x] Task 7: Quality Assurance and Testing (AC: 1, 4, 6, 8)
  - [x] Test cross-platform compatibility
  - [x] Validate Homebrew installation process
  - [x] Test agent integration functionality
  - [x] Create user acceptance testing scenarios
  - [x] Test cross-platform installation on macOS, Linux, and Windows
  - [x] Validate CLI functionality consistency across platforms

## Implementation Results

### Completed Deliverables

**CLI Infrastructure:**

- ✅ `krci-ai` CLI tool implemented with Cobra framework and colorized output
- ✅ Basic command structure with `install` command and help/version functionality
- ✅ Cross-platform binary builds for macOS (amd64/arm64), Linux (amd64/arm64), Windows (amd64)

**Distribution Infrastructure:**

- ✅ Homebrew tap repository created and configured
- ✅ GoReleaser configuration for automated cross-platform builds
- ✅ GitHub Actions CI/CD pipeline with automated releases
- ✅ Professional-grade tooling with GPG signing and SBOM generation

**Asset Management:**

- ✅ Go embed directives for framework asset embedding
- ✅ Agent discovery and parsing functionality
- ✅ Framework installation validation with directory structure checks
- ✅ `krci-ai list agents` command with verbose output support

**Integration & Testing:**

- ✅ Agent integration with manually created agents from Stories 01.01-01.05
- ✅ Cross-platform compatibility validated across macOS, Linux, Windows
- ✅ User acceptance testing scenarios covering all acceptance criteria
- ✅ End-to-end installation and validation workflows

**Build System:**

- ✅ Makefile with comprehensive build automation and version injection
- ✅ Modern toolchain: golangci-lint v1.64.8, goreleaser v2.10.2, staticcheck 2025.1.1
- ✅ Professional validation infrastructure with schema compliance
- ✅ Complete release automation with semantic versioning

## QA Checklist

### Functional Testing

- [x] **CLI Commands**: Test `krci-ai --help` and `krci-ai --version` - Expected: proper output
- [x] **Install Command**: Test `krci-ai install` functionality - Expected: creates proper directory structure
- [x] **Agent Listing**: Test `krci-ai list agents` command - Expected: displays installed agents

### Distribution Testing

- [x] **Homebrew**: Test `brew install kuberocketai/tap/krci-ai` on macOS - Expected: successful installation
- [x] **Cross-Platform**: Test binary execution on macOS, Linux, Windows - Expected: consistent functionality
- [x] **Release Pipeline**: Validate GitHub Actions automated releases - Expected: proper artifacts generated

### Integration Testing

- [x] **Agent Integration**: Verify CLI works with agents from Stories 01.01-01.05 - Expected: seamless integration
- [x] **Asset Embedding**: Confirm Go embed directives work correctly - Expected: assets properly embedded
- [x] **Framework Validation**: Test installation validation logic - Expected: proper error handling and success confirmation
