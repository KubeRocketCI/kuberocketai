# Story 03.01: Basic Install Command Implementation

## Status

| Field                  | Value                    |
|------------------------|--------------------------|
| Status                 | Completed                |
| Epic                   | Epic 3 - Install Command |
| Priority               | High                     |
| Estimated Story Points | 8                        |
| Jira                   | TBD                      |

## Dependencies

- **Epic 2 Complete**: Core Engine (Asset Processing and Validation) required for install command implementation

## Story

**As a** Framework Developer,
**I want** a basic `krci-ai install` command that can extract and install embedded framework components from the CLI binary,
**so that** users can easily set up the KubeRocketAI framework in their local projects with proper directory structure completely offline.

## Acceptance Criteria

1. `krci-ai install` command successfully extracts embedded framework assets from CLI binary
2. Local `./krci-ai/` directory created with proper framework structure (agents, tasks, templates, data)
3. Embedded asset extraction handles framework component organization
4. Installation works completely offline without network dependencies
5. Command-line interface provides clear feedback during installation process
6. Cross-platform compatibility for macOS, Linux, and Windows
7. Basic validation ensures extracted framework components are properly structured
8. Command gracefully handles existing `./krci-ai/` directory scenarios
9. `--ide=` flag support added to prepare for Epic 4 IDE integration (flag accepted but IDE-specific logic deferred)
10. Command validates IDE flag values and provides appropriate help text for supported IDEs

## Tasks/Subtasks

- [x] Task 1: Implement Basic Install Command Structure (AC: 1, 5)
  - [x] Create `cmd/install/install.go` with cobra.Command structure
  - [x] Add install command to main CLI application using github.com/spf13/cobra v1.8.0
  - [x] Implement basic command-line argument parsing and validation
  - [x] Add colorized output using fatih/color v1.17.0 for user feedback
  - [x] Create help documentation and usage examples for install command
  - [x] Validate: Run `make build` - Expected: successful build with install command
  - [x] Validate: Run `./dist/krci-ai install --help` - Expected: help text displays
- [x] Task 2: Build Embedded Asset Extraction (AC: 1, 3, 4)
  - [x] Implement embedded asset extraction using Go embed functionality
  - [x] Add asset validation and integrity checking
  - [x] Create offline asset extraction without network dependencies
  - [x] Implement embedded asset discovery and enumeration
  - [x] Add error handling for missing or corrupted embedded assets
  - [x] Validate: Run `go test ./internal/assets/...` - Expected: all tests pass
  - [x] Validate: Check embedded assets exist with `go run -ldflags="-X main.debug=true" ./cmd/krci-ai version`
- [x] Task 3: Create Local Directory Management (AC: 2, 8)
  - [x] Implement `./krci-ai/` directory creation with proper permissions
  - [x] Create framework subdirectory structure: agents/, tasks/, templates/, data/
  - [x] Add existing directory detection and handling logic
  - [x] Implement cross-platform path handling using filepath package
  - [x] Create directory structure validation after installation
  - [x] Validate: Run `./dist/krci-ai install && ls -la .krci-ai/` - Expected: directories created
  - [x] Validate: Check permissions with `stat .krci-ai/` - Expected: proper permissions
- [x] Task 4: Implement Asset Organization and Validation (AC: 2, 7)
  - [x] Build asset organization logic for extracted embedded components
  - [x] Implement framework component organization into proper directories
  - [x] Add basic file validation for required framework components
  - [x] Create asset metadata tracking for installed components
  - [x] Implement extraction validation and integrity checking
  - [x] Validate: Run `./dist/krci-ai validate` - Expected: validation passes
  - [x] Validate: Check asset structure with `find .krci-ai -type f | wc -l` - Expected: >0 files
- [x] Task 5: Add Cross-Platform Compatibility (AC: 6)
  - [x] Test install command on macOS, Linux, Windows platforms
  - [x] Implement platform-specific path handling and file operations
  - [x] Add platform-specific asset extraction validation
  - [x] Test file permissions and directory creation across platforms
  - [x] Validate offline operations and error handling on different platforms
  - [x] Validate: Run `make build-all` - Expected: all platform binaries build
  - [x] Validate: Test each binary with `./dist/krci-ai-*-* install --help` - Expected: consistent output
- [x] Task 6: IDE Flag Support Implementation (AC: 9, 10)
  - [x] Add `--ide` flag to install command with validation for supported IDEs
  - [x] Implement IDE flag validation for: cursor, claude, windsurf, vscode
  - [x] Add IDE flag help text and documentation
  - [x] Store IDE preference in local configuration for Epic 4 usage
  - [x] Implement graceful handling when IDE flag is provided but IDE-specific logic is not yet implemented
  - [x] Validate: Run `./dist/krci-ai install --ide=cursor` - Expected: accepts flag, stores preference
  - [x] Validate: Run `./dist/krci-ai install --ide=invalid` - Expected: validation error with help text
- [x] Task 7: Integration Testing and Validation (AC: 1-10)
  - [x] Create comprehensive install command test suite
  - [x] Test installation from embedded assets
  - [x] Test offline operation scenarios and error handling
  - [x] Validate directory structure creation and component organization
  - [x] Test existing directory scenarios and error handling
  - [x] Test IDE flag validation and error handling
  - [x] Validate: Run `make test` - Expected: all tests pass with coverage
  - [x] Validate: Run `make lint` - Expected: linting passes
  - [x] Validate: Run `make ci` - Expected: full CI pipeline passes

## Description

This story establishes the core installation infrastructure for the KubeRocketAI framework, implementing the foundational `krci-ai install` command that enables offline framework deployment through embedded asset extraction. As the cornerstone of Epic 3's installation and update management capabilities, this story directly addresses BR1 and NFR2 requirements by providing single-command installation without network dependencies. The implementation creates the local framework directory structure and integrates with Epic 2's validation engine while preparing for Epic 4's IDE integration through flag support.

## Implementation Results

### Completed Deliverables

**Install Command Infrastructure:**

- ✅ `cmd/krci-ai/cmd/install.go` - Complete install command with cobra.Command structure
- ✅ `internal/assets/installer.go` - Asset installation logic with embedded filesystem support
- ✅ `internal/assets/discovery.go` - Agent discovery and YAML parsing capabilities
- ✅ CLI output utilities with colorized feedback using fatih/color v1.17.0

**Asset Management System:**

- ✅ Embedded framework assets (54 files) using Go's embed.FS functionality
- ✅ Complete offline asset extraction without network dependencies
- ✅ Framework directory structure: `.krci-ai/agents/`, `tasks/`, `templates/`, `data/`, `config/`
- ✅ Asset integrity validation and error handling for corrupted assets

**IDE Integration System:**

- ✅ Multi-IDE support: `--ide=cursor,claude,vscode,windsurf,all` flags implemented
- ✅ Cursor IDE integration: `.cursor/rules/*.mdc` file generation
- ✅ Claude Code integration: `.claude/commands/*.md` file generation
- ✅ VS Code integration: `.github/chatmodes/*.chatmode.md` file generation
- ✅ IDE preference storage in local configuration

**Cross-Platform Compatibility:**

- ✅ Cross-platform builds with `make build-all` for linux/amd64, linux/arm64, darwin/amd64, darwin/arm64, windows/amd64
- ✅ Platform-specific path handling using Go's filepath package
- ✅ Consistent behavior across macOS, Linux, Windows platforms

**Validation and Quality:**

- ✅ `krci-ai validate` command implemented with comprehensive framework validation
- ✅ 89 files validated successfully with 0 errors, 10 warnings
- ✅ Existing directory detection with `--force` flag for graceful overrides
- ✅ Comprehensive error messages and user guidance

### Validation Results

**Build and Test Results:**

- ✅ `make build` - Successful build with install command integration
- ✅ `make test` - All tests passing with coverage requirements met
- ✅ `make lint` - Linting passes without errors using golangci-lint
- ✅ `make ci` - Full CI pipeline validation successful

**Functional Verification:**

- ✅ Basic installation: `./dist/krci-ai install` creates complete `.krci-ai/` structure
- ✅ Help documentation: `./dist/krci-ai install --help` displays comprehensive usage
- ✅ Asset extraction: 54 framework files extracted and organized properly
- ✅ IDE integration: `--ide=cursor --force` creates `.cursor/rules/` with 6 agent files
- ✅ Validation integration: `./dist/krci-ai validate` confirms installation integrity

## QA Checklist

### Functional Testing

- [x] **Basic Installation**: Run `./dist/krci-ai install` - Expected: `.krci-ai/` directory created with subdirectories
- [x] **Command Help**: Run `./dist/krci-ai install --help` - Expected: usage instructions display
- [x] **Asset Extraction**: Check `find .krci-ai -name "*.yaml" | wc -l` - Expected: >0 YAML files extracted
- [x] **Directory Structure**: Run `ls -la .krci-ai/` - Expected: agents/, tasks/, templates/, data/ directories exist
- [x] **Offline Operation**: Disconnect network, run install - Expected: installation succeeds
- [x] **IDE Flag Validation**: Run `./dist/krci-ai install --ide=cursor` - Expected: flag accepted, preference stored
- [x] **Invalid IDE Flag**: Run `./dist/krci-ai install --ide=invalid` - Expected: error with supported IDE list
- [x] **Existing Directory**: Run install twice - Expected: graceful handling of existing directory

### Integration Testing

- [x] **Build Integration**: Run `make build` - Expected: binary builds successfully
- [x] **Validation Integration**: Run `./dist/krci-ai validate` after install - Expected: validation passes
- [x] **Cross-Platform**: Test on macOS/Linux/Windows - Expected: consistent behavior
- [x] **Asset Integrity**: Compare extracted files with embedded - Expected: identical content
- [x] **Permission Validation**: Check directory permissions - Expected: appropriate read/write permissions

### Quality Assurance

- [x] **Code Quality**: Run `make lint` - Expected: linting passes without errors
- [x] **Test Coverage**: Run `make test` - Expected: >80% test coverage, all tests pass
- [x] **Static Analysis**: Run `make vet` and `make staticcheck` - Expected: no issues reported
- [x] **Performance**: Install command completes in <5 seconds - Expected: fast installation
- [x] **Error Handling**: Test with corrupted assets - Expected: graceful error messages
- [x] **Memory Usage**: Monitor memory during installation - Expected: <100MB peak usage
