# Story 99.04: IDE Command Support for Claude Code and Cursor

## Status

| Field                  | Value                       |
|------------------------|-----------------------------|
| Status                 | Draft                       |
| Epic                   | Epic 99: Technical Debt Consolidation and Enhancement |
| Priority               | High                        |
| Estimated Story Points | 8                           |
| Jira                   | None                        |

## Dependencies

**Blocking:**
- None

**Blocked By:**
- Epic 99.01 (Task Dependency Tracking System)

**System/Test Dependencies:**
- Claude Code extension environment for testing
- Cursor IDE environment for testing
- Agent framework with all 10 personas available

## Story

**As a** Framework User (Developer/PM/PO/QA/Architect),
**I want** quick access to the most frequently used KubeRocketAI commands directly within Claude Code and Cursor IDEs,
**so that** I can efficiently execute common agent tasks without leaving my development environment.

## Acceptance Criteria

1. **Claude Code Integration**: Implement command palette integration with top 10 KubeRocketAI commands accessible via Claude Code
2. **Cursor Integration**: Implement command palette integration with top 10 KubeRocketAI commands accessible via Cursor IDE
3. **Command Selection**: Support the 10 most frequently used commands: create-story, create-github-issues, review-story, implement, plan-implementation, create-prd, create-project-brief, plan (QA), create-sad, update-story
4. **Agent Context**: Commands automatically activate appropriate agent personas (PO, Dev, PM, QA, Architect) based on command selection
5. **IDE Integration**: Commands integrate seamlessly with IDE workflow, respecting current project context and file focus
6. **Configuration**: Support for user customization of which commands appear in IDE command palette
7. **Testing & Validation**: Comprehensive testing across both IDEs with all supported commands
8. **Documentation**: User documentation and setup guides for both IDE integrations

## Description

This story focuses on enhancing developer productivity by bringing the most commonly used KubeRocketAI framework commands directly into the two primary IDEs used by the team: Claude Code and Cursor.

The integration will provide quick access to essential framework operations without requiring users to switch contexts between their IDE and terminal/external tools. This addresses a key productivity barrier where users need to remember command syntax and switch between different tools to execute framework tasks.

### IDE-Specific Command Implementation Approaches

**Claude Code Integration:**
Based on Anthropic's Claude Code application with custom slash commands:
- **Project Commands**: Custom commands stored in `.claude/commands/` directory as Markdown files, shared with team
- **Slash Command Syntax**: Commands executed using `/command-name [arguments]` format
- **Frontmatter Support**: Commands support metadata via frontmatter (description, allowed-tools, argument-hint, model)
- **Argument Handling**: Supports `$ARGUMENTS` for all arguments or positional arguments (`$1`, `$2`, etc.)
- **File References**: Commands can reference files using `@filename` syntax
- **Bash Execution**: Commands can execute bash commands using `!` prefix with appropriate tool permissions
- **Dynamic Arguments**: Commands accept dynamic values through argument placeholders

**Cursor IDE Integration:**
Cursor offers a unique AI-powered approach to command integration:
- **Custom Commands**: Commands are defined as Markdown files stored in the `.cursor/rules` directory within the project
- **Chat-Based Execution**: Commands are triggered using the `/` prefix in Cursor's AI chat interface (e.g., `/create-story`)
- **AI Context Awareness**: Cursor's AI can understand command context and provide intelligent assistance during execution
- **Dynamic Command Discovery**: Commands are automatically discovered and made available through the chat interface when stored in the `.cursor/rules` directory
- **Markdown Documentation**: Each command file serves as both implementation and documentation, providing clear usage instructions
- **Project-Specific Commands**: Commands can be customized per project by placing appropriate Markdown files in the project's `.cursor/rules` directory

**Framework Agent Command Integration:**
Both IDEs will integrate with the KubeRocketAI agent command interface:
- **Standard Commands**: All agents provide `help` and `chat` commands as defined in ADR-005
- **Agent-Specific Commands**: Each agent exposes specialized commands (e.g., PO: `create-story`, Dev: `implement`)
- **Command-to-Task Mapping**: Commands map to framework tasks using `command: "description" → uses: task-name` format
- **Behavioral Context**: Agent personas influence task execution results within their defined scope
- **Self-Documentation**: Agents contain their own capability definitions, eliminating external documentation needs

### Framework Command Alignment

The story focuses on the top 10 most frequently used commands identified from the framework's agent personas:
- **Product Owner tasks**: create-story, update-story, review-story, create-github-issues
- **Developer tasks**: implement, plan-implementation
- **Product Manager tasks**: create-prd, create-project-brief
- **QA tasks**: plan (test planning)
- **Architect tasks**: create-sad

## Technical Context

The implementation leverages AI-powered command capabilities to provide slash command integration for both Claude Code and Cursor. The technical approach involves:

**Context Awareness**: Design the integration to be context-aware, leveraging the current file, project structure, and IDE state to pre-populate command inputs where possible.

**Configuration Management**: Implement user-configurable command sets, allowing teams to customize which commands appear based on their specific workflow needs.

### Technical Implementation Examples

**Claude Code Integration** ([Official Documentation](https://docs.anthropic.com/en/docs/claude-code/slash-commands#custom-slash-commands))

Claude Code supports custom slash commands through Markdown files with frontmatter configuration:

```markdown
---
allowed-tools: Bash(git add:*), Bash(git status:*)
argument-hint: [epic-number]
description: Create a new user story for specified epic
---

Create a user story for Epic $1 using the KubeRocketAI framework.

Context files:
@.krci-ai/tasks/create-story.md
@.krci-ai/data/common/sdlc-framework.md
@.krci-ai/templates/story.md

Current project context: !`ls -la docs/epics/`

Execute the create-story task with Epic $1 context and generate the story following our framework standards.
```

**File Location:**
- Project commands: `.claude/commands/krci-ai/tasks/create-story.md`

**Cursor IDE Integration** ([Official Documentation](https://docs.cursor.com/en/agent/chat/commands))

Cursor supports custom commands through Markdown files in the project directory:

```markdown
# Create Story

Create a user story for the specified epic using KubeRocketAI framework.

## Usage
/create-story [epic-number]

## Context
This command references the create-story task from our framework:
- Task definition: .krci-ai/tasks/create-story.md
- SDLC framework: .krci-ai/data/common/sdlc-framework.md
- Story template: .krci-ai/templates/story.md

Please follow the task instructions to create a comprehensive user story with proper Epic traceability and acceptance criteria.
```

**File Location:**
- Project commands: `.cursor/rules/krci-ai/tasks/create-story.md`

### Framework Integration Approach

**Task File Referencing**: Both IDEs will need to reference framework task files and their dependencies:
- Task instructions from `.krci-ai/tasks/[task-name].md`
- Data dependencies from `.krci-ai/data/` directory
- Template files from `.krci-ai/templates/` directory

**Agent Context Delivery**: Commands must provide appropriate agent persona context to ensure AI responses align with specific roles (PO, Developer, PM, QA, Architect).

**Dependency Resolution**: Investigation needed to determine best approach for including task dependencies - whether through file references, content inclusion, or hybrid approach.

### Proposed Directory Structure

The integration will follow official IDE paths with KubeRocketAI namespace organization:

**Claude Code Structure:**

```bash
.claude/
└── commands/        # Official Claude Code path
    └── krci-ai/     # Framework namespace
        ├── agents/          # Agent-specific command bundles
        │   ├── po.md        # Product Owner agent commands
        │   ├── dev.md       # Developer agent commands
        │   ├── pm.md        # Product Manager agent commands
        │   ├── qa.md        # QA agent commands
        │   └── architect.md # Architect agent commands
        └── tasks/           # Individual task commands
            ├── create-story.md
            ├── implement-feature.md
            ├── create-prd.md
            ├── review-story.md
            └── create-github-issues.md
```

**Cursor Structure:**

```bash
.cursor/
└── rules/           # Official Cursor path
    └── krci-ai/     # Framework namespace
        ├── agents/          # Agent-specific command bundles
        │   ├── po.md        # Product Owner agent commands
        │   ├── dev.md       # Developer agent commands
        │   ├── pm.md        # Product Manager agent commands
        │   ├── qa.md        # QA agent commands
        │   └── architect.md # Architect agent commands
        └── tasks/           # Individual task commands
            ├── create-story.md
            ├── implement-feature.md
            ├── create-prd.md
            ├── review-story.md
            └── create-github-issues.md
```

This structure enables:
- **Agent-Level Commands**: `/po`, `/dev`, `/pm` - activate entire agent context with all capabilities
- **Task-Level Commands**: `/create-story`, `/implement` - execute specific tasks with appropriate agent context
- **Consistent Organization**: Mirrors the framework's core structure for intuitive navigation

## Tasks/Subtasks

- [ ] **Task 1: Framework Analysis and Feasibility Investigation (AC: 3, 4)**
  - [ ] Analyze existing framework structure to understand how tasks and agents work
  - [ ] Map top 10 identified commands to existing framework tasks and agents
  - [ ] Investigate how task files are structured and what dependencies they have
  - [ ] Research best approach for IDE command integration with existing framework

- [ ] **Task 2: Claude Code Integration Investigation (AC: 1, 5)**
  - [ ] Investigate Claude Code slash command capabilities and requirements
  - [ ] Research how to reference framework task files in Claude Code commands
  - [ ] Explore options for including task dependencies and templates in commands
  - [ ] Investigate different approaches: direct file inclusion, referencing, or hybrid approach
  - [ ] Create prototype commands to test feasibility
  - [ ] Document recommended approach for Claude Code integration

- [ ] **Task 3: Cursor IDE Integration Investigation (AC: 2, 5)**
  - [ ] Investigate Cursor IDE command capabilities and requirements
  - [ ] Research how to reference framework task files in Cursor commands
  - [ ] Explore Cursor's chat-based execution model and task context requirements
  - [ ] Investigate different approaches for task content delivery to Cursor's AI
  - [ ] Create prototype commands to test feasibility and user experience
  - [ ] Document recommended approach for Cursor integration

- [ ] **Task 4: Integration Approach Testing and Validation (AC: 6, 7)**
  - [ ] Test different approaches for task content delivery to IDEs
  - [ ] Investigate dependency resolution and template inclusion methods
  - [ ] Validate prototype commands work effectively in both IDE environments
- [ ] Assess user experience and workflow efficiency of different approaches

## Implementation Results

*This section will be populated after implementation completion*

## QA Checklist

### Functional

- [ ] Command Discovery: All 10 commands appear in IDE command palettes (Expect: commands visible)
- [ ] Agent Activation: `create-story` activates PO persona (Expect: PO agent response)
- [ ] Context Preservation: Commands respect current IDE file/project context (Expect: relevant pre-population)
- [ ] Cross-Platform: Extensions work on macOS/Linux/Windows (Expect: consistent behavior)

### Integration

- [ ] Claude Code Integration: Command execution within Claude Code (Expect: successful execution)
- [ ] Cursor Integration: Command execution within Cursor (Expect: successful execution)
- [ ] CLI Bridge: IDE commands properly interface with KubeRocketAI CLI (Expect: identical output)
